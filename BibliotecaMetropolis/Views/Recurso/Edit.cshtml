@model BibliotecaMetropolis.Models.Recurso

@{
    ViewData["Title"] = "Edit";
}

<h1>Edit</h1>

<h4>Recurso</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Edit">
            <div asp-validation-summary="All" class="text-danger"></div>
            <input type="hidden" asp-for="IdRec" />
            <div class="form-group">
                <label asp-for="Titulo" class="control-label"></label>
                <input asp-for="Titulo" class="form-control" />
                <span asp-validation-for="Titulo" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="AnnoPublic" class="control-label"></label>
                <input asp-for="AnnoPublic" class="form-control" />
                <span asp-validation-for="AnnoPublic" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Edicion" class="control-label"></label>
                <input asp-for="Edicion" class="form-control" />
                <span asp-validation-for="Edicion" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="PalabrasBusqueda" class="control-label"></label>
                <input asp-for="PalabrasBusqueda" class="form-control" />
                <span asp-validation-for="PalabrasBusqueda" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Descripcion" class="control-label"></label>
                <input asp-for="Descripcion" class="form-control" />
                <span asp-validation-for="Descripcion" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="CantidadUnidades" class="control-label"></label>
                <input asp-for="CantidadUnidades" class="form-control" />
                <span asp-validation-for="CantidadUnidades" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="PrecioIndividual" class="control-label"></label>
                <input asp-for="PrecioIndividual" class="form-control" />
                <span asp-validation-for="PrecioIndividual" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="IdPais" class="control-label"></label>
                <select asp-for="IdPais" class="form-control" asp-items="ViewBag.IdPais"></select>
                <span asp-validation-for="IdPais" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="IdTipoR" class="control-label"></label>
                <select asp-for="IdTipoR" class="form-control" asp-items="ViewBag.IdTipoR"></select>
                <span asp-validation-for="IdTipoR" class="text-danger"></span>
            </div>
                    <!-- Campos extra visibles solo si el tipo es "Tesis" -->
            <div id="tesisFields" style="display:none;">
            <hr />
            <h5 class="fw-bold">Datos de la Institución (solo para Tesis)</h5>

            <div class="mb-3">
             <label class="form-label">Correo de contacto</label>
            <input type="email" name="CorreoContacto" class="form-control"
               value="@ViewBag.CorreoContacto" placeholder="ejemplo@universidad.edu" />
            </div>

            <div class="mb-3">
             <label class="form-label">Teléfono</label>
            <input type="text" name="Telefono" class="form-control"
               value="@ViewBag.Telefono" placeholder="2222-2222" />
            </div>

              <div class="mb-3">
            <label class="form-label">Sitio Web</label>
           <input type="url" name="SitioWeb" class="form-control"
               value="@ViewBag.SitioWeb" placeholder="https://www.universidad.edu" />
             </div>
            </div>

            <script>
            // Mostrar u ocultar los campos de tesis
            const tipoSelect = document.getElementById("IdTipoR");
            const tesisFields = document.getElementById("tesisFields");

            tipoSelect.addEventListener("change", function () {
             const selectedText = tipoSelect.options[tipoSelect.selectedIndex].text.toLowerCase();
            tesisFields.style.display = selectedText.includes("tesis") ? "block" : "none";
            });

            // Mostrar automáticamente si el recurso ya es de tipo Tesis
            window.addEventListener("load", function () {
            const selectedText = tipoSelect.options[tipoSelect.selectedIndex]?.text.toLowerCase() || "";
            tesisFields.style.display = selectedText.includes("tesis") ? "block" : "none";
            });
            </script>

            <hr />
            <h5 class="fw-bold">Autores del recurso</h5>
            <p class="text-muted">Selecciona uno o varios autores. Debes designar un autor principal.</p>

            <div class="mb-3">
            <label class="form-label">Autores</label>
                @Html.ListBox(
                            "autoresSeleccionados",
                            new MultiSelectList(ViewBag.Autores, "IdAutor", "NombreCompleto", ViewBag.AutoresSeleccionados),
                            new { @class = "form-select", size = "6" }
                        )
            </div>

            <div class="mb-3">
            <label class="form-label">Autor principal</label>
                @Html.DropDownList(
                            "autorPrincipal",
                            new SelectList(ViewBag.Autores, "IdAutor", "NombreCompleto", ViewBag.AutorPrincipal),
                            "Seleccione un autor principal",
                            new { @class = "form-select" }
                        )
            </div>

            <div asp-validation-summary="All" class="text-danger"></div>


            <div class="form-group">
                <label asp-for="IdEdit" class="control-label"></label>
                <select asp-for="IdEdit" class="form-control" asp-items="ViewBag.IdEdit"></select>
                <span asp-validation-for="IdEdit" class="text-danger"></span>
            </div

            <div class="form-group">
                <input type="submit" value="Save" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
