@model BibliotecaMetropolis.Models.Recurso

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>

<h4>Recurso</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create">
            <div asp-validation-summary="All" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="Titulo" class="control-label"></label>
                <input asp-for="Titulo" class="form-control" />
                <span asp-validation-for="Titulo" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="AnnoPublic" class="control-label"></label>
                <input asp-for="AnnoPublic" class="form-control" />
                <span asp-validation-for="AnnoPublic" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Edicion" class="control-label"></label>
                <input asp-for="Edicion" class="form-control" />
                <span asp-validation-for="Edicion" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="PalabrasBusqueda" class="control-label"></label>
                <input asp-for="PalabrasBusqueda" class="form-control" />
                <span asp-validation-for="PalabrasBusqueda" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Descripcion" class="control-label"></label>
                <input asp-for="Descripcion" class="form-control" />
                <span asp-validation-for="Descripcion" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="CantidadUnidades" class="control-label"></label>
                <input asp-for="CantidadUnidades" class="form-control" />
                <span asp-validation-for="CantidadUnidades" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="PrecioIndividual" class="control-label"></label>
                <input asp-for="PrecioIndividual" class="form-control" />
                <span asp-validation-for="PrecioIndividual" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="IdPais" class="control-label"></label>
                <select asp-for="IdPais" class ="form-control" asp-items="ViewBag.IdPais"></select>
            </div>
            <div class="form-group">
                <label asp-for="IdTipoR" class="control-label"></label>
                <select asp-for="IdTipoR" class ="form-control" asp-items="ViewBag.IdTipoR"></select>
            </div>
            <!-- Campos extra visibles solo si el tipo es "Tesis" -->
<div id="tesisFields" style="display:none;">
    <hr />
    <h5 class="fw-bold">Datos de la Institución (solo para Tesis)</h5>

    <div class="mb-3">
        <label class="form-label">Correo de contacto</label>
        <input type="email" name="CorreoContacto" class="form-control" placeholder="ejemplo@universidad.edu" />
    </div>

    <div class="mb-3">
        <label class="form-label">Teléfono</label>
        <input type="text" name="Telefono" class="form-control" placeholder="2222-2222" />
    </div>

    <div class="mb-3">
        <label class="form-label">Sitio Web</label>
        <input type="url" name="SitioWeb" class="form-control" placeholder="https://www.universidad.edu" />
    </div>
</div>

<script>
    // Mostrar u ocultar los campos según el tipo de recurso
    const tipoSelect = document.getElementById("IdTipoR");
    const tesisFields = document.getElementById("tesisFields");

    tipoSelect.addEventListener("change", function () {
        const selectedText = tipoSelect.options[tipoSelect.selectedIndex].text.toLowerCase();
        tesisFields.style.display = selectedText.includes("tesis") ? "block" : "none";
    });

    // Ejecutar al cargar la página
    window.addEventListener("load", function () {
        const selectedText = tipoSelect.options[tipoSelect.selectedIndex]?.text.toLowerCase() || "";
        tesisFields.style.display = selectedText.includes("tesis") ? "block" : "none";
    });
</script>

            <div class="form-group">
                <label asp-for="IdEdit" class="control-label"></label>
                <select asp-for="IdEdit" class ="form-control" asp-items="ViewBag.IdEdit"></select>
            </div>

            <div class="form-group mt-3">
    <label class="fw-bold">Autores</label>
                @Html.ListBox(
                            "autoresSeleccionados",
                            (MultiSelectList)ViewData["Autores"],
                            new { @class = "form-select", multiple = "multiple", size = "5" }
                        )
    <small class="text-muted d-block">Mantén presionado Ctrl (o Cmd) para seleccionar varios autores.</small>
</div>

<div class="form-group mt-3">
    <label class="fw-bold">Autor Principal</label>
                @{
                    var autoresList = ((MultiSelectList)ViewData["Autores"]).Select(a => new SelectListItem
            {
                Value = a.Value,
                Text = a.Text
            });
                }
                @Html.DropDownList(
                            "autorPrincipal",
                            new SelectList(autoresList, "Value", "Text"),
                            "Seleccione un autor principal",
                            new { @class = "form-select" }
                        )
</div>


            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
