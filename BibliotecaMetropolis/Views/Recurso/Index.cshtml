@model IEnumerable<BibliotecaMetropolis.Models.Recurso>

@{
    ViewData["Title"] = "Recursos Disponibles";
    
}

<h1 class="fw-bold text-glow-primary mb-3">
    <i class="bi bi-journal-bookmark-fill me-2"></i> Catálogo de Recursos
</h1>
<hr class="glow-hr mb-4" />

<p>
    <a asp-action="Create" class="btn btn-futuristic btn-glow-success mb-4 text-white">
        <i class="bi bi-plus-circle me-1 text-white"></i> Crear Nuevo Recurso
    </a>
</p>

@using (Html.BeginForm("Index", "Recurso", FormMethod.Get))
{
    <div class="card card-futuristic mb-4 p-4">
        <div class="row g-3 align-items-end">

            <div class="col-md-3">
                <label class="form-label text-white fw-bold">Buscar por Título o Autor</label>
                <input type="text" name="searchTitulo" class="form-control form-control-futuristic"
                       value="@Context.Request.Query["searchTitulo"]"
                       placeholder="Ejemplo: Título o Autor..." />
            </div>

            <div class="col-md-2">
                <label class="form-label text-white fw-bold">Tipo</label>
                @Html.DropDownList("idTipoR", (SelectList)ViewData["IdTipoR"], "Todos", new { @class = "form-select form-control-futuristic" })
            </div>

            <div class="col-md-2">
                <label class="form-label text-white fw-bold">País</label>
                @Html.DropDownList("idPais", (SelectList)ViewData["IdPais"], "Todos", new { @class = "form-select form-control-futuristic" })
            </div>

            <div class="col-md-2">
                <label class="form-label text-white fw-bold">Editorial</label>
                @Html.DropDownList("idEdit", (SelectList)ViewData["IdEdit"], "Todas", new { @class = "form-select form-control-futuristic" })
            </div>

            <div class="col-md-2 d-flex align-items-center">
                <div class="form-check form-check-futuristic">
                    <input class="form-check-input" type="checkbox" name="ultimos10" value="true"
                           @(ViewData["Ultimos10"] != null && (bool)ViewData["Ultimos10"] ? "checked" : "") />
                    <label class="form-check-label text-white">Últimos 10 años</label>
                </div>
            </div>

            <div class="col-md-1">
                <button type="submit" class="btn btn-glow-primary w-100 mt-3">
                    <i class="bi bi-search text-white"></i>
                </button>
            </div>

        </div>
    </div>
}

<div class="table-responsive">
    <table class="table table-futuristic align-middle">
        <thead>
            <tr class="table-header-futuristic">
                <th>Título</th>
                <th>Año P.</th>
                <th>Edición</th>
                <th>Palabras Clave</th>
                <th>Descripción</th>
                <th>Unidades</th>
                <th>Precio U.</th>
                <th>País</th>
                <th>Tipo</th>
                <th>Editorial</th>
                <th>Autores</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr class="table-row-futuristic">
                    <td class="text-glow-primary">@Html.DisplayFor(modelItem => item.Titulo)</td>
                    <td>@Html.DisplayFor(modelItem => item.AnnoPublic)</td>
                    <td>@Html.DisplayFor(modelItem => item.Edicion)</td>
                    <td>@Html.DisplayFor(modelItem => item.PalabrasBusqueda)</td>
                    <td title="@item.Descripcion">@(item.Descripcion.Length > 30 ? item.Descripcion.Substring(0, 30) + "..." : item.Descripcion)</td>
                    <td>@Html.DisplayFor(modelItem => item.CantidadUnidades)</td>
                    <td>@Html.DisplayFor(modelItem => item.PrecioIndividual)</td>
                    <td>@Html.DisplayFor(modelItem => item.Pais.Nombre)</td>
                    <td>@Html.DisplayFor(modelItem => item.TipoRecurso.Nombre)</td>
                    <td>@Html.DisplayFor(modelItem => item.Editorial.Nombre)</td>

                    <td class="autores-list">
                        @if (item.AutoresRecursos != null && item.AutoresRecursos.Any())
                        {
                            foreach (var ar in item.AutoresRecursos)
                            {
                                if (ar.Autor != null)
                                {
                                    if (ar.EsPrincipal)
                                    {
                                        <span class="text-glow-warning fw-bold d-block">
                                            @($"{ar.Autor.Nombres} {ar.Autor.Apellidos}") <small class="text-warning">(P)</small>
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="text-white d-block small">@($"{ar.Autor.Nombres} {ar.Autor.Apellidos}")</span>
                                    }
                                }
                            }
                        }
                        else
                        {
                            <span class="text-muted small">Sin autores</span>
                        }
                    </td>

                    <td class="text-nowrap">
                        <a asp-action="Edit" asp-route-id="@item.IdRec" class="btn btn-sm btn-outline-warning btn-icon-neoned"><i class="bi bi-pencil"></i></a>
                        <a asp-action="Details" asp-route-id="@item.IdRec" class="btn btn-sm btn-outline-info btn-icon-neoned"><i class="bi bi-eye"></i></a>
                        <a asp-action="Delete" asp-route-id="@item.IdRec" class="btn btn-sm btn-outline-danger btn-icon-neoned"><i class="bi bi-trash"></i></a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>